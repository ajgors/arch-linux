'use strict';var cva={TAB:0,ol:1,wp:2},Y$=function(a){Bb("MediaRouter.WebRtc.Start.Success",a,cva)};var Z$=function(a,b){Aj.call(this,b);this.F=a;this.l=new Cb;this.g=Vu(b.id);this.m=new Cb;this.G=!1;this.s=null;this.D=!1;this.u=this.w=null;dva(this);eva(this);this.g.sendMessage(new Gj("GET_TURN_CREDENTIALS"))};q(Z$,Aj);
Z$.prototype.start=function(a){var b=this;return this.l.g.then(function(c){if(c.g)return Promise.reject(new Ei("Mirroring already started"));if(b.s)return Promise.reject(new Ei("Session permanently stopped"));b.w=new rb("MediaRouter.WebRtc.Session.Launch");c.ka.addStream(a);c.start();return b.m.g})};
Z$.prototype.stop=function(){var a=this;this.m.reject(new Ei("Session stop requested."));this.u&&(this.u.end(),this.u=null);if(this.s)return this.s;this.D=this.G=!1;this.w=null;return this.s=this.l.g.then(function(b){b.stop()}).then(function(){return a.g.eb()}).catch(function(b){a.g.eb();throw b;})};
var dva=function(a){a.g.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.l.resolve(new Lj(a.h.id,b.data.credentials));break;case "ANSWER":a.l.g.then(function(c){Tj(c,b.data)});break;case "KNOCK_ANSWER":a.D=!0;a.l.g.then(function(c){Tj(c,b.data)});break;case "STOP":a.m.reject(new Ei("Stop signal received"));a.stop();break;default:throw new Ei("Unknown message type: "+b.type);}}},eva=function(a){a.l.g.then(function(b){Pj(b,function(c){a.g.sendMessage(new Gj("OFFER",
new Ij(c,a.F,Jj)))});Qj(b,function(c){c=Hj(c);a.g.sendMessage(c)});Mj(b,function(){a.G=!0;a.g.sendMessage(new Gj("SESSION_START_SUCCESS"));!a.D&&a.w&&a.w.end();a.w=null;a.u=new xb("MediaRouter.WebRtc.Session.Length");a.m.resolve(a)});Oj(b,function(){a.g.sendMessage(new Gj("SESSION_END"))});Nj(b,function(c){a.G||a.m.reject(c);a.g.sendMessage(new Gj("SESSION_FAILURE"))})})};var $$=function(){pj.call(this,"webrtc")};q($$,pj);h=$$.prototype;h.Lh=function(a,b){return new Z$(a,b)};h.rh=function(){Y$(0)};h.oh=function(){Y$(1)};h.pi=function(){Y$(2)};h.ph=function(){Ab("MediaRouter.WebRtc.Session.End")};h.og=function(a){Bb("MediaRouter.WebRtc.Start.Failure",a,Di)};h.qh=function(){Ab("MediaRouter.WebRtc.Stream.End")};var fva=new $$;fj("mr.mirror.webrtc.WebRtcService",fva);
